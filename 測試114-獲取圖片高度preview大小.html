<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script src="https://tw.hicdn.beanfun.com/jquery/jquery.min.js"></script>
		<script src="https://tw.hicdn.beanfun.com/jquery/jquery-migrate.min.js"></script>
		<script src="https://tw.hicdn.beanfun.com/beanfun/GamaWWW/allProducts/script/gbox/gbox.js"></script>
		<!-- GTM -->
		<script>
			(function (w, d, s, l, i) {
				w[l] = w[l] || [];
				w[l].push({
					"gtm.start": new Date().getTime(),
					event: "gtm.js"
				});
				var f = d.getElementsByTagName(s)[0],
					j = d.createElement(s),
					dl = l != "dataLayer" ? "&l=" + l : "";
				j.async = true;
				j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
				f.parentNode.insertBefore(j, f);
			})(window, document, "script", "dataLayer", "GTM-PTL7HNM");
		</script>
	</head>
	<body>
		<!-- GTM -->
		<noscript>
			<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PTL7HNM" height="0" width="0" style="display: none; visibility: hidden"></iframe>
		</noscript>
		<input type="file" id="file" />
		<button type="button" class="btn">送出</button>
		<img src="" alt="" id="img" />
		<script>
			var fileUploader = document.querySelector("#file");
			var imageView = document.querySelector("#img");
			var fileReader = new FileReader();
			fileUploader.addEventListener("change", function (event) {
				console.log(this.files[0]);
				console.log(this.files[0].size / 1024);
				fileReader.readAsDataURL(this.files[0]);
			});
			fileReader.addEventListener("load", function (event) {
				//讀取後設定<img>的src
				// imageView.src = this.result;
				var img = new Image();
				img.onload = function () {
					console.log(img.width); // image is loaded; sizes are available
				};
				img.src = this.result;
				console.log(this.result);
			});
			const checkImage = async (url) => {
				return new Promise((resolve, reject) => {
					var elem = new Image();
					setTimeout(() => {
						elem.onload = () => resolve(true);
						elem.onerror = () => resolve(false);
						elem.src = url;
					}, 2000);
				});
			};
			$(".btn").on("click", async function () {
				// var img = new Image();
				// img.onload = function () {
				// 	console.log(this.width); // image is loaded; sizes are available
				// };
				// img.onerror = function () {
				// 	console.log("error"); // image is loaded; sizes are available
				// };
				// img.src = "https://fakeimg.pl/440x320/282828/eae0d0/?retina=1";
				// checkImage("https://fakeimg.pl/440x320/282828/eae0d0/?retina=1").then((res) => {
				// 	console.log(res);
				// });
				console.log("Start");
				let arr = ["https://fakeimg.pl/440x320/282828/eae0d0/?retina=1", "https://fakeimg.pl/440x320/282828/eae0d0/?retina=1", "https://fakeimg.pl/440x320/282828/eae0d0/?retina=1", "https://fakeimg.pl/440x320/282828/eae0d0/?retina=1"];

				for (let i = 0; i < arr.length; i++) {
					console.log(await checkImage(arr[i]));
				}
				console.log("End");
				// var img = await checkImage("https://fakeimg.pl/440x320/282828/eae0d0/?retina=1");
				// if (img) {
				// 	console.log("first");
				// }
				// console.log("two");
			});

			function ErrorLB(msg) {
				console.log("error");
				var config = {
					addClass: "default lb-event",
					hasCloseBtn: true,
					hasActionBtn: false,
					afterClose: function () {
						$.gbox.close();
					}
				};
				var HTML = '<div class="lb-title lb-title__error"></div>\
				<div class="lb-container">\
					<div class="lb-content lb-content--center lb-content--error">' + msg + "</div>\
				</div>";
				$.gbox.open(HTML, config);
			}
		</script>
	</body>
</html>
