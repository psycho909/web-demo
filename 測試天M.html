<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        button {
            padding: 0;
            font-family: inherit;
            font-size: inherit;
            color: inherit;
            border: 0;
            background-color: transparent;
            cursor: pointer;
            -webkit-appearance: button;
        }

        .section {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 50% 0;
        }

        .drag-wrap {
            overflow: hidden !important;
            width: 100%;
            height: 100vh;
        }

        .draggable {}

        .video {
            position: absolute;
            top: 0px;
            left: 0px;
            visibility: inherit;
            opacity: 1;
            transform: matrix(1, 0, 0, 1, 0, 0);
        }

        .btn-general {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            z-index: 6;
            margin: 183px auto 0;
            width: 307px;
            height: 78px;
            cursor: pointer;
            margin: 183px auto 0;
            width: 307px;
            height: 78px;
            background: url(https://wstatic-cdn.plaync.com/promo/lineagem/event/2020/trinity/img/gate/btn_general_pc.png) 0 0/307px auto no-repeat;
        }

        .section .spot-list {
            position: absolute;
            z-index: 5;
        }

        .container .section.section-banquet .draggable .spot-list {
            max-width: 2280px;
            left: 0;
            right: 0;
            margin: 0 auto;
        }

        .container .section.section-banquet .btn-next {
            position: absolute;
            top: 510px;
            left: 1040px;
            display: block;
            text-align: left;
            text-indent: -9999em;
            white-space: nowrap;
            overflow: hidden;
            width: 188px;
            height: 198px;
            background-image: url(https://wstatic-cdn.plaync.com/promo/lineagem/event/2020/trinity/img/banquet/btn_next.png);
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .section-banquet,
        .section-livingroom {
            display: none;
        }

        .section .spot-list .btn-next {
            position: absolute;
            top: 0;
            left: 0;
            width: 152px;
            height: 170px;
            background-image: url(https://wstatic-cdn.plaync.com/promo/lineagem/event/2020/trinity/img/btn_next.png);
            background-repeat: no-repeat;
            background-position: 0 0;
            background-size: 152px auto;
            color: #efddc0;
            text-indent: 0;
            padding: 0 0 0 85px;
            font-size: 16px;
        }

        .container .section.section-livingroom .btn-next {
            top: 522px;
            left: 2120px;
        }

        .section .spot-list .btn-next {
            width: 241px;
            height: 241px;
            background-image: url(https://wstatic-cdn.plaync.com/promo/lineagem/event/2020/trinity/img/btn_next_pc.png);
            background-size: 241px auto;
            padding: 0 0 0 100px;
            font-size: 24px;
        }
    </style>
</head>

<body>
    <div id="container" class="container">
        <div class="section section-gate">
            <div class="drag-wrap">
                <div class="draggable">
                    <video class="secGateloop video"
                        src="https://vod.plaync.com/lineageM/new/1_castlerooping_PC_low.mp4" autoplay muted
                        loop></video>
                    <video class="secGateOut video" src="https://vod.plaync.com/lineageM/castle/2_enter_PC_low.mp4"
                        muted></video>
                </div>
            </div>
            <div class="section-contents">
                <button type="button" class="btn-general" data-name="banquet">입장하기</button>
            </div>
        </div>
        <div class="section section-banquet">
            <div class="drag-wrap">
                <div class="draggable">
                    <div class="spot-list">
                        <button type="button" class="btn-next" data-name="livingroom"
                            style="visibility: inherit; opacity: 1; transform: matrix(1, 0, 0, 1, 0, 0);">응접실</button>
                    </div>
                    <video id="" class="secBanquetIntro" playsinline="" muted="muted"
                        style="position: absolute; top: 0px; left: 0px; width: 2276px; z-index: 0; display: none;">
                        <source src="https://vod.plaync.com/lineageM/new/1_partyenter_PC_low.mp4" type="video/mp4">
                    </video>
                    <video id="" class="secBanquetLoop" playsinline="" muted="muted" loop=""
                        style="position: absolute; top: 0px; left: 0px; width: 2276px; visibility: inherit; opacity: 1; z-index: 0; display: none;">
                        <source src="https://vod.plaync.com/lineageM/party/2_rooping_PC_low2.mp4" type="video/mp4">
                    </video>
                    <video id="" class="secBanquetLoop2" playsinline="" muted="muted" loop=""
                        style="position: absolute; top: 0px; left: 0px; width: 2276px; visibility: inherit; opacity: 1; z-index: 0; display: none;">
                        <source src="https://vod.plaync.com/lineageM/new/3_afterkey_PC_low.mp4" type="video/mp4">
                    </video>
                    <video id="" class="secBanquetOut" playsinline="" muted="muted"
                        style="position: absolute; top: 0px; left: 0px; width: 2276px; z-index: 0; display: none;">
                        <source src="https://vod.plaync.com/lineageM/party/4_golobby_PC_low2.mp4" type="video/mp4">
                    </video>
                </div>
            </div>
            <div class="section-contents">

            </div>
        </div>
        <div class="section section-livingroom">
            <div class="drag-wrap">
                <div class="draggable">
                    <div class="spot-list">
                        <button class="btn-next" data-name="passage">복도</button>
                    </div>
                    <video id="" class="secLivingroomloop" preload="auto" playsinline="" muted="muted" loop=""
                        style="position: absolute; top: 0px; left: 0px; width: 2760px; z-index: 0; display: none;">
                        <source src="https://vod.plaync.com/lineageM/new/PC_living_low.mp4" type="video/mp4">
                    </video>
                </div>
            </div>
            <div class="section-contents"></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/utils/Draggable.min.js"></script>
    <script>
        var videoList = {
            gate: {
                mobile: {
                    loop: {
                        url: "https://vod.plaync.com/lineageM/new/1_castlerooping_MO_low.mp4",
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    },
                    out: {
                        url: "https://vod.plaync.com/lineageM/castle/2_enter_MO_low.mp4",
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    }
                },
                pc: {
                    loop: {
                        url: "https://vod.plaync.com/lineageM/new/1_castlerooping_PC_low.mp4",
                        width: 2276,
                        height: 1280
                    },
                    out: {
                        url: "https://vod.plaync.com/lineageM/castle/2_enter_PC_low.mp4",
                        width: 2276,
                        height: 1280
                    }
                }
            },
            banquet: {
                mobile: {
                    intro: {
                        url: 'https://vod.plaync.com/lineageM/new/sujungapear_MO_high.mp4',
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    },
                    loop: {
                        url: 'https://vod.plaync.com/lineageM/party/2_rooping_MO_low2.mp4',
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    },
                    loop2: {
                        url: 'https://vod.plaync.com/lineageM/new/3_afterkey_MO_low.mp4',
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    },
                    out: {
                        url: 'https://vod.plaync.com/lineageM/party/4_golobby_MO_low2.mp4',
                        width: 1920 * 0.7,
                        height: 1080 * 0.7
                    }
                },
                pc: {
                    intro: {
                        url: 'https://vod.plaync.com/lineageM/new/1_partyenter_PC_low.mp4',
                        width: 2276,
                        height: 1280
                    },
                    loop: {
                        url: 'https://vod.plaync.com/lineageM/party/2_rooping_PC_low2.mp4',
                        width: 2276,
                        height: 1280
                    },
                    loop2: {
                        url: 'https://vod.plaync.com/lineageM/new/3_afterkey_PC_low.mp4',
                        width: 2276,
                        height: 1280
                    },
                    out: {
                        url: 'https://vod.plaync.com/lineageM/party/4_golobby_PC_low2.mp4',
                        width: 2276,
                        height: 1280
                    }
                }
            },
            livingroom: {
                mobile: {
                    loop: {
                        url: 'https://vod.plaync.com/lineageM//new/MO_living_low.mp4',
                        width: 2156 * 0.7,
                        height: 1000 * 0.7
                    }
                },
                pc: {
                    loop: {
                        url: 'https://vod.plaync.com/lineageM//new/PC_living_low.mp4',
                        width: 2760,
                        height: 1280
                    }
                }
            }
        };
        function MoviePlayer(_option){
            this.option={
                url:"",
                id:"",
                movieW:640,
                movieH:360,
                videoControl:'autoplay="true" loop="true" preload="auto"',
                isBgType:false,
            }
            $.extend(true,this.option,_option)
            return this.optionW
        }
        function Common(obj,part){
            this.part=part;
            this.videoList=obj;
            this.wind=$(window);
            this.scrTop=0;
            this.scrLeft=0;
            this.drag;
            this.device="pc";
        };
        Common.prototype.deviceCheck=function(){
            this.device="pc";
            this.videoList=this.videoList[this.device];
        }
        Common.prototype.init=function(){
            this.deviceCheck();
            this.setTopLeft();
            this.setDrag();
        }
        Common.prototype.setTopLeft=function(){
            var _this=this;
            $(".section-" + this.part + " .video").each(function(i,v){
                $(v).css({
                    width: _this.videoList.loop.width + "px",
                    height: _this.videoList.loop.height + "px",
                })
            })
            
        }
        Common.prototype.setDrag=function(){
            var _this=this;
            var drag = Draggable.create(".section-" + this.part + " .drag-wrap", {
                type: "scroll",
                edgeResistance: 1,
                throwProps: true
            })[0];
            TweenMax.set(this.drag.scrollProxy, {
                scrollLeft: (_this.scrLeft < 0 ? 0 : _this.scrLeft),
                scrollTop: (_this.scrTop < 0 ? 0 : _this.scrTop)
            })
        }
        Common.prototype.videoRest=function(video, zindex, isShow){
            video.toggle(isShow)
            video.css("zIndex", zindex);
            return video[0];
        }

        Common.prototype.setAniObj=function(){
            var _this=this;
            TweenMax.to(this.drag.scrollProxy, 0.6, { 
                scrollLeft: (_this.scrLeft<0? 0: _this.scrLeft), 
                scrollTop: (_this.scrTop<0? 0: _this.scrTop), 
                ease: Quint.easeOut
            });
        }

        Common.prototype.reset=function(){
            this.setAniObj();
        }

        function initVideo(part) {
            var $win = $(window);
            var scrTop = -Math.round(($win.height() - videoList[part].pc.loop.height) / 2);
            var scrLeft = -Math.round(($win.width() - videoList[part].pc.loop.width) / 2);
            $(".section-" + part + " .secGateloop").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            $(".section-" + part + " .secGateOut").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            var drag = Draggable.create(".section-" + part + " .drag-wrap", {
                type: "scroll",
                edgeResistance: 1,
                throwProps: true
            })[0]
            TweenMax.set(drag.scrollProxy, {
                scrollLeft: (scrLeft < 0 ? 0 : scrLeft),
                scrollTop: (scrTop < 0 ? 0 : scrTop)
            })
        }

        function initVideo2(part) {
            var $win = $(window);
            var scrTop = -Math.round(($win.height() - videoList[part].pc.loop.height) / 2);
            var scrLeft = -Math.round(($win.width() - videoList[part].pc.loop.width) / 2);
            TweenMax.set($(".btn-next[data-name=livingroom]"), {
                autoAlpha: 0,
                scale: 0.7
            });
            $(".section-" + part + " .secBanquetIntro").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            $(".section-" + part + " .secBanquetLoop").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            $(".section-" + part + " .secBanquetLoop2").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            $(".section-" + part + " .secBanquetOut").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            var drag = Draggable.create(".section-" + part + " .drag-wrap", {
                type: "scroll",
                edgeResistance: 1,
                throwProps: true
            })[0]
            TweenMax.set(drag.scrollProxy, {
                scrollLeft: (scrLeft < 0 ? 0 : scrLeft),
                scrollTop: (scrTop < 0 ? 0 : scrTop)
            })
        }

        function initVideo3(part) {
            var $win = $(window);
            var scrTop = -Math.round(($win.height() - videoList[part].pc.loop.height) / 2);
            var scrLeft = -Math.round(($win.width() - videoList[part].pc.loop.width) / 2);

            $(".section-" + part + " .secLivingroomloop").css({
                width: videoList[part].pc.loop.width + "px",
                height: videoList[part].pc.loop.height + "px",
            })
            var drag = Draggable.create(".section-" + part + " .drag-wrap", {
                type: "scroll",
                edgeResistance: 1,
                throwProps: true
            })[0]
            TweenMax.set(drag.scrollProxy, {
                scrollLeft: (scrLeft < 0 ? 0 : scrLeft),
                scrollTop: (scrTop < 0 ? 0 : scrTop)
            })
            TweenMax.set($(".secLivingroomloop"), { autoAlpha: 0, scale: 1.3 });
        }

        function videoRest(video, zindex, isShow) {
            video.toggle(isShow)
            video.css("zIndex", zindex);
            return video[0];
        }
        initVideo("gate")
        videoRest($(".secGateloop"), 2, true)
        videoRest($(".secGateOut"), 1, false)

        // 要先初始化 並一開始定位於畫面中間
        var drag = Draggable.create(".section-" + "gate" + " .drag-wrap", {
                type: "scroll",
                edgeResistance: 1,
                throwProps: true
            })[0]
        var $win=$(window);
        var scrTop = -Math.round(($win.height() - videoList["gate"].pc.loop.height) / 2);
        var scrLeft = Math.abs(Math.round(($win.width() - videoList["gate"].pc.loop.width) / 2));
        TweenMax.to(drag.scrollProxy, 0.6, { 
            scrollLeft: (scrLeft<0? 0: scrLeft), 
            scrollTop: (scrTop<0? 0: scrTop), 
            ease: Quint.easeOut
        });
        function end1(part) {
            var $win=$(window);

            var scrTop = -Math.round(($win.height() - videoList[part].pc.loop.height) / 2);
            // var scrLeft = -Math.round(($win.width() - videoList[part].pc.loop.width) / 2);
            var scrLeft = Math.abs(Math.round(($win.width() - videoList[part].pc.loop.width) / 2));
            // 改 可以重複使用
            // var drag = Draggable.create(".section-" + "gate" + " .drag-wrap", {
            //     type: "scroll",
            //     edgeResistance: 1,
            //     throwProps: true
            // })[0]

            TweenMax.to(drag.scrollProxy, 0.6, { 
                scrollLeft: (scrLeft<0? 0: scrLeft), 
                scrollTop: (scrTop<0? 0: scrTop), 
                ease: Quint.easeOut
            });

            videoRest($(".secGateloop"), 1, true).pause()
            setTimeout(function () {
                videoRest($(".secGateloop"), 0, false)
            }, 1000);
            videoRest($(".secGateOut"), 2, true).play(0)

            TweenMax.to($(".btn-general"), 1.2, {
                autoAlpha: 0,
                scale: 1.3,
                y: 50,
                ease: Quint.easeIn
            });
            
        }

        function end2(part) {
            var nextName = "livingroom";
            videoRest($(".secBanquetIntro"), 0, false).pause()
            if (nextName === "livingroom") {
                videoRest($(".secBanquetLoop1"), 0, false)
                videoRest($(".secBanquetLoop2"), 1, true).pause()

                setTimeout(function () {
                    videoRest($(".secBanquetLoop2"), 0, false)
                }, 1000);
                videoRest($(".secBanquetOut"), 2, true).play(0)
                var scrLeft = Math.abs(Math.round(($win.width() - videoList[part].pc.width) / 2));
                var scrTop = -Math.round(($win.height() - videoList[part].pc.height) / 2);
                TweenMax.to(drag.scrollProxy, 0.6, { scrollLeft: scrLeft, scrollTop: (scrTop < 0 ? 0 : scrTop), ease: Quint.easeOut });
                TweenMax.to($(".btn-next[data-name=livingroom]"), 1.2, {
                    autoAlpha: 0,
                    scale: 0.7,
                    ease: Quint.easeIn
                });
            }
        }
        function end3(part) {
            var $win = $(window);
            var nextName = "passage";

            var tOrigin = 'center';
            var scrLeft = Math.abs(Math.round(($win.width() - videoList[part].pc.width) / 2));
            var scrTop = -Math.round(($win.height() - videoList[part].pc.height) / 2);
            
            if (nextName === "passage") {
                scrLeft = Math.abs(Math.round(($win.width() - videoList[part].pc.width)));
                tOrigin = 'right';
            }
            // var drag = Draggable.create(".section-" + part + " .drag-wrap", {
            //     type: "scroll",
            //     edgeResistance: 1,
            //     throwProps: true
            // })[0]
            TweenMax.to(drag.scrollProxy, 0.6, { scrollLeft: scrLeft, scrollTop: (scrTop < 0 ? 0 : scrTop), ease: Quint.easeOut });
            videoRest($(".secLivingroomloop"), 1, true).pause();
            TweenMax.to($(".secLivingroomloop"), 1.3, {
                autoAlpha: 0, scale: 1.3, ease: Expo.easeIn, transformOrigin: tOrigin, onComplete: function(){
                    // this.transitionEnd();
                    console.log(123)
                }
            });
        }

        function showLastBtns() {
            TweenMax.to($(".btn-next[data-name=livingroom]"), 0.5, {
                autoAlpha: 1,
                scale: 1
            });
        }
        $(".secGateOut")[0].onended = function () {
            $(".section-gate").hide()
            $(".section-banquet").show();
            initVideo2("banquet")
            videoRest($(".secBanquetIntro"), 2, true).play(0)
        }

        $(".secBanquetIntro")[0].onended = function () {
            videoRest($(".secBanquetIntro"), 1, true).pause()
            setTimeout(function () {
                videoRest($(".secBanquetIntro"), 1, false)
            }, 1000);
            videoRest($(".secBanquetLoop2"), 2, true).play(0)
            showLastBtns()
        }

        $(".secBanquetOut")[0].onended = function () {
            $(".section-banquet").hide();
            $(".section-livingroom").show()
            initVideo3("livingroom")
            TweenMax.to($(".secLivingroomloop"), 1.7, { autoAlpha: 1, scale: 1, ease: Quint.easeOut });
            videoRest($(".secLivingroomloop"), 2, true).play(0)
            
        }

        $(".btn-general").on("click", function () {
            end1("gate")
        })

        $(".btn-next[data-name=livingroom]").on("click", function () {
            end2("banquet")
        })
        $(".btn-next[data-name=passage]").on("click", function () {
            end3("livingroom")
        })
        $("#container").on("sec.end", function (event, param1, param2) {
            console.log(param1 + "\n" + param2);
        });
        // $("#container").trigger("sec.end",["A","B"])
        // TweenMax.to(this.vidLoop.node, 1.3, {
        //     autoAlpha: 0, scale: 1.3, ease: Expo.easeIn, transformOrigin: tOrigin, onComplete: () => {
        //         this.transitionEnd();
        //     }
        // });
    </script>
</body>

</html>