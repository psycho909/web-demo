<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="stylesheet" href="https://tw.hicdn.beanfun.com/beanfun/GamaWWW/MapleStory/Event/E20230606/assets/css/default.css" />
		<script src="https://tw.hicdn.beanfun.com/plugins/vue/3.2.45/vue.global.js"></script>
		<script src="https://tw.hicdn.beanfun.com/plugins/vue/3.2.45/vue.global.prod.min.js"></script>
		<!-- <script src="https://tw.hicdn.beanfun.com/plugins/loadingProgress/loadingProgress.js"></script> -->
	</head>
	<body>
		<div id="loadingProgress" class="loadingProgress"><div class="loadingProgress-num"></div></div>
		<div id="app">
			<image-load @media-loaded="handleMediaLoaded"></image-load>

			<!-- 上方浮動選單 -->
			<div class="top-bar">
				<a href="https://maplestory.beanfun.com/main" class="top-bar__logo" target="_blank">logo</a><a href="javascript:;" class="top-bar__open"></a>
				<div class="top-bar-box login">
					<a href="javascript:;" class="top-bar__close"></a>
					<div class="top-bar__content">
						<div class="top-bar__item active"><a href="javascript::">全新職業卡莉</a></div>
						<div class="top-bar__item"><a href="javascript::">Savior版本活動</a></div>
						<div class="top-bar__item"><a href="javascript::">美味楓潮</a></div>
					</div>
					<div class="top-bar__right">
						<div class="top-bar__username">account</div>
						<a href="../../logout/logout.aspx" class="top-bar__logout"></a>
						<div class="top-bar__social"><a href="https://maplestory.beanfun.com/main" class="btn-home" target="_blank"></a><a href="https://www.facebook.com/www.maplestory.msfans.com.tw" class="btn-f" target="_blank"></a><a href="https://www.instagram.com/maplestory_tw/ " class="btn-i" target="_blank"></a></div>
					</div>
				</div>
			</div>
			<!-- 右邊浮動選單 -->
			<div class="right-bar loading unloading"><a href="javascript:;" class="btn-top">TOP</a></div>
			<!-- 全新職業卡莉 -->
			<div class="sec sec1" id="sec1">
				<div class="sec1-bg">
					<video autoplay="" loop="" playsinline="" muted><source src="https://alpha-tw.beanfun.com/3KO/removable/maplestory/E20230606/assets/video/bg2.mp4" type="video/mp4" /></video>
				</div>
				<div class="sec-wrap">
					<div class="sec1-title"></div>
					<div class="sec1-btn-group">
						<div class="sec1-btn__step3 loading">
							<a href="https://maplestory.beanfun.com/main" class="sec1-btn__link" target="_blank"></a>
							<div class="sec1-btn--normal"></div>
							<div class="sec1-btn--hover"></div>
							<canvas class="canvas1 sec1-btn__step3-canvas1" width="400" height="400"></canvas><canvas class="canvas2 sec1-btn__step3-canvas2" width="400" height="400"></canvas>
						</div>
					</div>
					<a href="javascript:;" class="sec1-character"
						><div class="sec1-character--normal"></div>
						<canvas class="sec1-character__canvas1" width="928" height="928"></canvas><canvas class="sec1-character__canvas2" width="928" height="928"></canvas
					></a>
				</div>
				<canvas class="particles-js-canvas-el" style="width: 100%; height: 100%" width="1903" height="1080"></canvas>
			</div>
			<!-- Savior版本活動 -->
			<div class="sec sec2" id="sec2">
				<div class="pin-spacer" style="order: 0; place-self: auto; grid-area: auto; z-index: 1; float: none; flex-shrink: 1; display: block; margin: 0px; inset: 0px; position: relative; flex-basis: auto; overflow: visible; box-sizing: border-box; width: 1903px; height: 1613px; padding: 0px 0px 1400px">
					<div class="sec2-container" style="translate: none; rotate: none; scale: none; inset: 0px auto auto 0px; margin: 0px; max-width: 1903px; width: 1903px; max-height: 213px; height: 213px; padding: 0px; transform: translate(0px, 0px)">
						<div class="sec2-title" style="translate: none; rotate: none; scale: none; opacity: 0; transform: translate(0px, 0px)"></div>
						<div class="sec2-tab"></div>
						<div class="sec2-wrap" style="translate: none; rotate: none; scale: none; transform: translate(2016px, 0px)">
							<div class="sec2-swiper-wrap"><div class="sec2-content swiper-wrapper" data-sec2-content=""></div></div>
							<div class="swiper-button-prev"></div>
							<div class="swiper-button-next"></div>
						</div>
					</div>
				</div>
				<canvas class="particles-js-canvas-el" style="width: 100%; height: 100%" width="1903" height="1613"></canvas>
			</div>
			<!-- 品牌活動 -->
			<div class="sec sec3" id="sec3">
				<div class="sec3-meteor sec3-meteor1"></div>
				<div class="sec3-meteor sec3-meteor2"></div>
				<div class="sec3-meteor sec3-meteor3"></div>
				<div class="sec3-title"><canvas class="sec3-title__canvas" width="1200" height="200"></canvas></div>
				<div class="sec3-content">
					<div class="sec3-flim-tab-box"></div>
					<div class="sec3-flim-box">
						<div class="sec3-flim-swiper-box"><div class="sec3-flim-comming"></div></div>
					</div>
				</div>
				<canvas class="particles-js-canvas-el" style="width: 100%; height: 100%" width="1903" height="971"></canvas>
			</div>
		</div>
		<script>
			const imageLoad = {
				template: `
                <div>
                    <slot>{{ count }}</slot>
                </div>
                `,
				data() {
					return {
						count: 0
					};
				},
				mounted() {
					this.checkAllBackgroundImagesLoaded();
				},
				methods: {
					checkAllBackgroundImagesLoaded() {
						const elements = document.querySelectorAll("*");
						const mediaLoadPromises = Array.from(elements).map((element) => {
							return new Promise((resolve, reject) => {
								const backgroundImage = window.getComputedStyle(element).backgroundImage;
								const tagName = element.tagName.toLowerCase();
								this.count++;
								if (tagName === "video") {
									element.addEventListener("loadeddata", resolve);
									element.addEventListener("error", reject); // Optional: handle video loading errors
								} else if (backgroundImage && backgroundImage !== "none") {
									const imageUrl = this.extractImageUrl(backgroundImage);
									if (imageUrl) {
										const image = new Image();
										image.onload = resolve;
										image.onerror = reject;
										image.src = imageUrl;
									}
								} else {
									resolve(); // If element is not a video or doesn't have a background image, resolve immediately
								}
							});
						});

						Promise.all(mediaLoadPromises)
							.then(() => {
								console.log("All media loaded");
								document.querySelector(".loadingProgress").style = "display:none";
								this.$emit("media-loaded"); // 触发一个事件表示所有媒体都已经加载完成
							})
							.catch((error) => {
								console.error("Some media failed to load:", error);
								// 处理媒体加载失败的情况
							});
					},
					extractImageUrl(backgroundImage) {
						// 从背景图属性中提取URL的逻辑
						const regex = /url\(['"]?([^'"]+?)['"]?\)/;
						const match = backgroundImage.match(regex);
						return match ? match[1] : null;
					}
				}
			};

			let vm = Vue.createApp({
				components: {
					imageLoad
				},
				mounted() {},
				methods: {
					handleMediaLoaded() {
						console.log("handleMediaLoaded");
					}
				}
			});

			vm.mount("#app");
		</script>
	</body>
</html>
